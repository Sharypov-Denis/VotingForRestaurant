/*C3*/SET SCHEMA PUBLIC
DROP TABLE user_roles IF EXISTS
DROP TABLE voting IF EXISTS
DROP TABLE menu IF EXISTS
DROP TABLE restaurant IF EXISTS
DROP TABLE users IF EXISTS
DROP SEQUENCE global_seq IF EXISTS
CREATE SEQUENCE global_seq AS INTEGER START WITH 100000
CREATE TABLE users\u000a(\u000a    id         INTEGER GENERATED BY DEFAULT AS SEQUENCE GLOBAL_SEQ PRIMARY KEY,\u000a    name       VARCHAR(255)            NOT NULL,\u000a    email      VARCHAR(255)            NOT NULL,\u000a    password   VARCHAR(255)            NOT NULL,\u000a    registered TIMESTAMP DEFAULT now() NOT NULL,\u000a    enabled    BOOLEAN   DEFAULT TRUE  NOT NULL,\u000a)
CREATE UNIQUE INDEX users_unique_email_idx ON users (email)
CREATE TABLE user_roles\u000a(\u000a    user_id INTEGER NOT NULL,\u000a    role    VARCHAR(255),\u000a    CONSTRAINT user_roles_idx UNIQUE (user_id, role),\u000a    FOREIGN KEY (user_id) REFERENCES USERS (id) ON DELETE CASCADE\u000a)
CREATE TABLE restaurant\u000a(\u000a    id            INTEGER GENERATED BY DEFAULT AS SEQUENCE GLOBAL_SEQ PRIMARY KEY,\u000a    user_id       INTEGER NOT NULL,\u000a    name          VARCHAR(255)            NOT NULL,\u000a    numberOfVotes INTEGER   DEFAULT 2000  NOT NULL,\u000a        FOREIGN KEY (user_id) REFERENCES USERS (id) ON DELETE CASCADE\u000a)
CREATE TABLE menu\u000a(\u000a    id            INTEGER GENERATED BY DEFAULT AS SEQUENCE GLOBAL_SEQ PRIMARY KEY,\u000a    restaurant_id INTEGER NOT NULL,\u000a    name          VARCHAR(255)            NOT NULL,\u000a    price         INT     NOT NULL,\u000a    FOREIGN KEY (restaurant_id) REFERENCES restaurant (id) ON DELETE CASCADE\u000a)
CREATE TABLE voting\u000a(\u000a    id            INTEGER GENERATED BY DEFAULT AS SEQUENCE GLOBAL_SEQ PRIMARY KEY,\u000a    restaurant_id INTEGER   DEFAULT 2000  NOT NULL,\u000a    user_id       INTEGER   DEFAULT 2000  NOT NULL,\u000a    registered    TIMESTAMP DEFAULT now() NOT NULL\u000a)
DISCONNECT
/*C4*/SET SCHEMA PUBLIC
DISCONNECT
/*C5*/SET SCHEMA PUBLIC
ALTER SEQUENCE global_seq RESTART WITH 100000
INSERT INTO USERS VALUES(100000,'User','user@yandex.ru','password','2020-12-03 12:45:39.315000',TRUE)
INSERT INTO USERS VALUES(100001,'Admin','admin@gmail.com','admin','2020-12-03 12:45:39.315000',TRUE)
ALTER SEQUENCE PUBLIC.GLOBAL_SEQ RESTART WITH 100002
COMMIT
INSERT INTO USER_ROLES VALUES(100000,'USER')
INSERT INTO USER_ROLES VALUES(100001,'ADMIN')
COMMIT
INSERT INTO RESTAURANT VALUES(100001,100000,'RESTAURANT1',0)
INSERT INTO RESTAURANT VALUES(100002,100000,'RESTAURANT2',0)
INSERT INTO RESTAURANT VALUES(100003,100001,'RESTAURANT3',0)
COMMIT
INSERT INTO MENU VALUES(100002,100001,'KAKA1',1001)
INSERT INTO MENU VALUES(100003,100002,'KAKA2',1002)
INSERT INTO MENU VALUES(100004,100002,'KAKA2',2002)
INSERT INTO MENU VALUES(100005,100002,'KAKA22',2022)
INSERT INTO MENU VALUES(100006,100003,'KAKA3',3003)
ALTER SEQUENCE PUBLIC.GLOBAL_SEQ RESTART WITH 100007
COMMIT
INSERT INTO VOTING VALUES(100007,100001,100000,'2020-01-30 10:01:00.000000')
INSERT INTO VOTING VALUES(100008,100002,100000,'2020-01-30 10:02:00.000000')
INSERT INTO VOTING VALUES(100009,100003,100001,'2020-01-30 10:03:00.000000')
ALTER SEQUENCE PUBLIC.GLOBAL_SEQ RESTART WITH 100010
COMMIT
DISCONNECT
/*C6*/SET SCHEMA PUBLIC
DISCONNECT
/*C7*/SET SCHEMA PUBLIC
DISCONNECT
/*C8*/SET SCHEMA PUBLIC
DISCONNECT
/*C10*/SET SCHEMA PUBLIC
DISCONNECT
/*C9*/SET SCHEMA PUBLIC
INSERT INTO VOTING VALUES(100010,100003,100001,'2020-01-30 10:04:00.000000')
COMMIT
/*C13*/SET SCHEMA PUBLIC
DISCONNECT
/*C14*/SET SCHEMA PUBLIC
DISCONNECT
/*C16*/SET SCHEMA PUBLIC
DISCONNECT
/*C11*/SET SCHEMA PUBLIC
DISCONNECT
/*C15*/SET SCHEMA PUBLIC
DISCONNECT
/*C9*/DISCONNECT
/*C18*/SET SCHEMA PUBLIC
DELETE FROM VOTING WHERE ID=100007
DELETE FROM VOTING WHERE ID=100008
DELETE FROM VOTING WHERE ID=100009
DELETE FROM VOTING WHERE ID=100010
COMMIT
DELETE FROM MENU WHERE ID=100002
DELETE FROM MENU WHERE ID=100003
DELETE FROM MENU WHERE ID=100004
DELETE FROM MENU WHERE ID=100005
DELETE FROM MENU WHERE ID=100006
COMMIT
DELETE FROM RESTAURANT WHERE ID=100001
DELETE FROM RESTAURANT WHERE ID=100002
DELETE FROM RESTAURANT WHERE ID=100003
COMMIT
DELETE FROM USER_ROLES WHERE USER_ID=100000 AND ROLE='USER'
DELETE FROM USER_ROLES WHERE USER_ID=100001 AND ROLE='ADMIN'
COMMIT
DELETE FROM USERS WHERE ID=100000
DELETE FROM USERS WHERE ID=100001
COMMIT
ALTER SEQUENCE global_seq RESTART WITH 100000
INSERT INTO USERS VALUES(100000,'User','user@yandex.ru','password','2020-12-03 13:07:05.939000',TRUE)
INSERT INTO USERS VALUES(100001,'Admin','admin@gmail.com','admin','2020-12-03 13:07:05.939000',TRUE)
ALTER SEQUENCE PUBLIC.GLOBAL_SEQ RESTART WITH 100002
COMMIT
INSERT INTO USER_ROLES VALUES(100000,'USER')
INSERT INTO USER_ROLES VALUES(100001,'ADMIN')
COMMIT
INSERT INTO RESTAURANT VALUES(100001,100000,'RESTAURANT1',0)
INSERT INTO RESTAURANT VALUES(100002,100000,'RESTAURANT2',0)
INSERT INTO RESTAURANT VALUES(100003,100001,'RESTAURANT3',0)
COMMIT
INSERT INTO MENU VALUES(100002,100001,'KAKA1',1001)
INSERT INTO MENU VALUES(100003,100002,'KAKA2',1002)
INSERT INTO MENU VALUES(100004,100002,'KAKA2',2002)
INSERT INTO MENU VALUES(100005,100002,'KAKA22',2022)
INSERT INTO MENU VALUES(100006,100003,'KAKA3',3003)
ALTER SEQUENCE PUBLIC.GLOBAL_SEQ RESTART WITH 100007
COMMIT
INSERT INTO VOTING VALUES(100007,100001,100000,'2020-01-30 10:01:00.000000')
INSERT INTO VOTING VALUES(100008,100002,100000,'2020-01-30 10:02:00.000000')
INSERT INTO VOTING VALUES(100009,100003,100001,'2020-01-30 10:03:00.000000')
ALTER SEQUENCE PUBLIC.GLOBAL_SEQ RESTART WITH 100010
COMMIT
DISCONNECT
/*C19*/SET SCHEMA PUBLIC
DISCONNECT
/*C20*/SET SCHEMA PUBLIC
DISCONNECT
/*C21*/SET SCHEMA PUBLIC
DISCONNECT
/*C17*/SET SCHEMA PUBLIC
DISCONNECT
/*C12*/SET SCHEMA PUBLIC
DISCONNECT
